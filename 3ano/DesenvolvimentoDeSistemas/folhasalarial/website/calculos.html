<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Pricing - Brand</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i">
    <link rel="stylesheet" href="assets/css/styles.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css">
</head>

<body onLoad="fillTable()">
    <nav
        class="navbar navbar-light navbar-expand-lg fixed-top bg-white clean-navbar">
        <div class="container"><a class="navbar-brand logo" href="#">Bigue
                Company</a><button data-bs-toggle="collapse"
                class="navbar-toggler" data-bs-target="#navcol-1"><span
                    class="visually-hidden">Toggle navigation</span><span
                    class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navcol-1">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link "
                            href="index.html">Funcionários</a></li>
                    <li class="nav-item"><a class="nav-link"
                            href="tabelas.html">Tabelas</a></li>
                    <li class="nav-item"><a class="nav-link  active"
                            href="calculos.html">Cálculos</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div style="margin-top: 160px;">
        <h1 style="text-align: center;font-weight: bold;">Salários</h1>
        <div class="table-responsive"
            style="margin-top: 30px;margin-right: 50px;margin-left: 50px;">
            <table class="table table-bordered table-striped table-hover">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Salário Base</th>
                        <th>INSS</th>
                        <th>Salário Família</th>
                        <th>Vale Transporte</th>
                        <th>IRRF</th>
                        <th>Salário Líquido</th>
                        <th>Holerite</th>
                    </tr>
                </thead>
                <tbody id="tableEmployeesBody">

                </tbody>
            </table>
        </div>
    </div>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.js"></script>
    <script src="assets/js/script.min.js"></script>
    <script>
        function fillTable() {
            const url = 'http://localhost:3000/employee'
            fetch(url)
                .then(function (response) {
                    return response.json()
                })
                .then(function (data) {
                    const employees = data
                    for (var line in employees) {
                        var name = employees[line].name
                        var baseSalary = employees[line].baseSalary
                        var inss = calcINSS(baseSalary)
                        var familySalary = (baseSalary <= 1655.98) ? (employees[line].childrenUnder14YearsOld * 56.47) : 0
                        var vt = (employees[line].wantTransportationVouchers) ? calcPercent(baseSalary, 6) : 0
                        var baseCalcSalary = baseSalary - inss - (employees[line].incomeTaxDependent * 189.59)
                        var irrf = calcIRFF(baseCalcSalary)
                        const finalSalary = baseSalary - inss + familySalary - vt - irrf
                        var newTableLine = `
                            <tr>
                                <td> ${name}</td>
                                <td>R$ ${baseSalary.toFixed(2)}</td>
                                <td>R$ ${inss.toFixed(2)}</td>
                                <td>R$ ${familySalary.toFixed(2)}</td>
                                <td>R$ ${vt.toFixed(2)}</td>
                                <td>R$ ${irrf.toFixed(2)}</td>
                                <td>R$ ${finalSalary.toFixed(2)}</td>
                                <td class="d-flex justify-content-center"><button
                                class="btn btn-primary" type="button">Ver
                                Holerite</button></td>
                            </tr>`
                        document.getElementById('tableEmployeesBody').innerHTML += newTableLine
                    }
                })
                .catch(function () {
                    console.log('Houve algum problema!')
                })
        }
        const calcPercent = (value, percent) => value * (percent / 100)
        function calcINSS(baseSalary) {
            var inss = 0
            if (baseSalary <= 1212) {
                inss = calcPercent(baseSalary, 7.5)
            } else if (baseSalary > 1212 && baseSalary <= 2427.36) {
                inss = calcPercent(1212, 7.5)
                inss += calcPercent((baseSalary - 1212.01), 9)
            } else if (baseSalary > 2427.36 && baseSalary <= 3641.03) {
                inss = calcPercent(1212, 7.5)
                inss += calcPercent((2427.36 - 1212.01), 9)
                inss += calcPercent((baseSalary - 2427.37), 12)
            } else if (baseSalary > 3641.03 && baseSalary <= 7087.22) {
                inss = calcPercent(1212, 7.5)
                inss += calcPercent((2427.36 - 1212.01), 9)
                inss += calcPercent((3641.03 - 2427.37), 12)
                inss += calcPercent((baseSalary - 3641.04), 14)
            } else {
                inss = calcPercent(1212, 7.5)
                inss += calcPercent((2427.36 - 1212.01), 9)
                inss += calcPercent((3641.03 - 2427.37), 12)
                inss += calcPercent((7087.22 - 3641.04), 14)
            }
            return inss
        }
        function calcIRFF(baseCalcSalary) {
            irrf = 0
            if (baseCalcSalary <= 1903.98) {
                irrf = 0
            } else if (baseCalcSalary > 1903.98 && baseCalcSalary <= 2826.65) {
                irrf = calcPercent(baseCalcSalary, 7.5) - 142.80
            } else if (baseCalcSalary > 2826.65 && baseCalcSalary <= 3751.05) {
                irrf = calcPercent(baseCalcSalary, 15) - 354.80
            } else if (baseCalcSalary > 3751.05 && baseCalcSalary <= 4664.68) {
                irrf = calcPercent(baseCalcSalary, 22.5) - 646.13
            } else {
                irrf = calcPercent(baseCalcSalary, 27.5) - 869.36
            }
            return irrf
        }
    </script>
</body>

</html>